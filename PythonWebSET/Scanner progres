import json
import re
from bs4 import BeautifulSoup
def scan_file(file):
    with open(file, "r") as f:
        html_code = f.read()
    html_clean = BeautifulSoup(html_code, "html.parser")

    issues = []
    issues.extend(BrokenAccessControl(html_clean))
    issues.extend(CryptographicFailures(html_clean))
    return {"issues": issues}

#@ francesca when you choose a vulnerability to start defining add it beneath line11 from the list below
"""
   
    issues.extend(sql_Injection(html_clean))
    issues.extend(InsecureDesign(html_clean))
    issues.extend(SecurityMisconfiguration(html_clean))
    issues.extend(Vulnerable_and_Outdated_Components(html_clean))
    issues.extend(Identification_and_Authentication_failures(html_clean))
    issues.extend(Software_and_Data_integrity_Failures(html_clean))
    issues.extend(Security_logging_and_monitoring_failures(html_clean))
    issues.extend(SSRF(html_clean))

    result = {
        "issues": [{"Threat": "id", "Threat Severity": "High|Medium|low", "Message": "Explanation"
            }
        ]

    }
    return result
"""
#Vulnerability Scanners Go Here

def BrokenAccessControl(html_clean):
    issues = []
    BAC = html_clean.find_all("script")
    for B in BAC:
        code = B.get_text()
        lower = code.lower()

        for word in ["role", "admin", "auth", "token", "key", "secret"]:
            if word in lower:
                issues.append({
                    "Threat": "Broken Access Control", "Threat Severity": "Medium", "Message": f"Keyword  '{word}' found in script."
                })

        if re.search(r"[sS][kK]-[A-Za-z0-9]{32,}", code):
            issues.append({"Threat": "Broken Access Control", "Threat Severity": "High", "Message": "Possible API key exposed in client-side code"

            })






    return issues

def CryptographicFailures(html_clean):
    issues = []
    CF = html_clean.find_all("script")
    for C in CF:
        code = C.get_text() or ""
        lower = code.lower()
        for algorithm in ["md5", "sha1", "des", "3des", "rc4"]:
            if algorithm in lower:
                issues.append({"Threat": "Cryptographic Failure", "Threat Severity": "High", "Message": f"Depreciated algorithm detected" '{algorithm.upper()}'})

        if "btoa(" in lower or "atob(" in lower:
            issues.append({"Threat": "Cryptographic Failure", "Threat Severity": "Medium",
                       "Message": "Use of bota()/atob() has been detected."})
        if "math.random(" in lower:
            issues.append({"Threat": "Cryptographic Failure", "Threat Severity": "Medium",
                       "Message": "math.random() has been used"})

        if "localstorage" in lower or "sessionstorage" in lower:
            issues.append({"Threat": "Cryptographic Failure", "Threat Severity": "Medium", "Message": "Web storage used, review if data stored is sensitive."})

        if re.search(r"")
    return issues
## END of Vulnerability Scanner section
if __name__ == "__main__":
    output = scan_file("sample.html")
    print(json.dumps(output, indent=4))
